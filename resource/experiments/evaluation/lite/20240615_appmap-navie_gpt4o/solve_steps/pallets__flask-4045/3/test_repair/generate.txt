@generate /noformat

<test-errors>
activate successful
CONDA_EXE=/usr/share/miniconda/bin/conda
_CE_M=
PWD=/home/runner/work/_temp/tmpdw7lpya2/pallets__flask__2.0-3
CONDA_PREFIX=/usr/share/miniconda/envs/pallets__flask__2.0-3
CONDA_PROMPT_MODIFIER=(pallets__flask__2.0-3) 
_CE_CONDA=
CONDA_SHLVL=1
SHLVL=1
CONDA_PYTHON_EXE=/usr/share/miniconda/bin/python
CONDA_DEFAULT_ENV=pallets__flask__2.0-3
CONDA_PKGS_DIRS=/usr/share/miniconda/cache
PATH=/usr/share/miniconda/envs/pallets__flask__2.0-3/bin:/usr/share/miniconda/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
_=/usr/bin/printenv
============================= test session starts ==============================
collecting ... collected 179 items

tests/test_basic.py::test_options_work FAILED                            [  0%]
tests/test_basic.py::test_options_on_multiple_rules FAILED               [  1%]
tests/test_basic.py::test_method_route[get] FAILED                       [  1%]
tests/test_basic.py::test_method_route[post] FAILED                      [  2%]
tests/test_basic.py::test_method_route[put] FAILED                       [  2%]
tests/test_basic.py::test_method_route[delete] FAILED                    [  3%]
tests/test_basic.py::test_method_route[patch] FAILED                     [  3%]
tests/test_basic.py::test_method_route_no_methods PASSED                 [  4%]
tests/test_basic.py::test_provide_automatic_options_attr FAILED          [  5%]
tests/test_basic.py::test_provide_automatic_options_kwarg FAILED         [  5%]
tests/test_basic.py::test_request_dispatching FAILED                     [  6%]
tests/test_basic.py::test_disallow_string_for_allowed_methods PASSED     [  6%]
tests/test_basic.py::test_url_mapping FAILED                             [  7%]
tests/test_basic.py::test_werkzeug_routing FAILED                        [  7%]
tests/test_basic.py::test_endpoint_decorator FAILED                      [  8%]
tests/test_basic.py::test_session FAILED                                 [  8%]
tests/test_basic.py::test_session_using_server_name FAILED               [  9%]
tests/test_basic.py::test_session_using_server_name_and_port FAILED      [ 10%]
tests/test_basic.py::test_session_using_server_name_port_and_path FAILED [ 10%]
tests/test_basic.py::test_session_using_application_root FAILED          [ 11%]
tests/test_basic.py::test_session_using_session_settings FAILED          [ 11%]
tests/test_basic.py::test_session_using_samesite_attribute FAILED        [ 12%]
tests/test_basic.py::test_session_localhost_warning FAILED               [ 12%]
tests/test_basic.py::test_session_ip_warning FAILED                      [ 13%]
tests/test_basic.py::test_missing_session FAILED                         [ 13%]
tests/test_basic.py::test_session_expiration FAILED                      [ 14%]
tests/test_basic.py::test_session_stored_last FAILED                     [ 15%]
tests/test_basic.py::test_session_special_types FAILED                   [ 15%]
tests/test_basic.py::test_session_cookie_setting FAILED                  [ 16%]
tests/test_basic.py::test_session_vary_cookie FAILED                     [ 16%]
tests/test_basic.py::test_flashes ERROR                                  [ 17%]
tests/test_basic.py::test_extended_flashing FAILED                       [ 17%]
tests/test_basic.py::test_request_processing FAILED                      [ 18%]
tests/test_basic.py::test_request_preprocessing_early_return FAILED      [ 18%]
tests/test_basic.py::test_after_request_processing FAILED                [ 19%]
tests/test_basic.py::test_teardown_request_handler FAILED                [ 20%]
tests/test_basic.py::test_teardown_request_handler_debug_mode FAILED     [ 20%]
tests/test_basic.py::test_teardown_request_handler_error FAILED          [ 21%]
tests/test_basic.py::test_before_after_request_order FAILED              [ 21%]
tests/test_basic.py::test_error_handling FAILED                          [ 22%]
tests/test_basic.py::test_error_handler_unknown_code PASSED              [ 22%]
tests/test_basic.py::test_error_handling_processing FAILED               [ 23%]
tests/test_basic.py::test_baseexception_error_handling FAILED            [ 24%]
tests/test_basic.py::test_before_request_and_routing_errors FAILED       [ 24%]
tests/test_basic.py::test_user_error_handling FAILED                     [ 25%]
tests/test_basic.py::test_http_error_subclass_handling FAILED            [ 25%]
tests/test_basic.py::test_errorhandler_precedence FAILED                 [ 26%]
tests/test_basic.py::test_trapping_of_bad_request_key_errors FAILED      [ 26%]
tests/test_basic.py::test_trapping_of_all_http_exceptions FAILED         [ 27%]
tests/test_basic.py::test_error_handler_after_processor_error FAILED     [ 27%]
tests/test_basic.py::test_enctype_debug_helper FAILED                    [ 28%]
tests/test_basic.py::test_response_types FAILED                          [ 29%]
tests/test_basic.py::test_response_type_errors FAILED                    [ 29%]
tests/test_basic.py::test_make_response ERROR                            [ 30%]
tests/test_basic.py::test_make_response_with_response_instance ERROR     [ 30%]
tests/test_basic.py::test_jsonify_no_prettyprint ERROR                   [ 31%]
tests/test_basic.py::test_jsonify_prettyprint ERROR                      [ 31%]
tests/test_basic.py::test_jsonify_mimetype ERROR                         [ 32%]
tests/test_basic.py::test_json_dump_dataclass ERROR                      [ 32%]
tests/test_basic.py::test_jsonify_args_and_kwargs_check ERROR            [ 33%]
tests/test_basic.py::test_url_generation ERROR                           [ 34%]
tests/test_basic.py::test_build_error_handler FAILED                     [ 34%]
tests/test_basic.py::test_build_error_handler_reraise FAILED             [ 35%]
tests/test_basic.py::test_url_for_passes_special_values_to_build_error_handler FAILED [ 35%]
tests/test_basic.py::test_static_files FAILED                            [ 36%]
tests/test_basic.py::test_static_url_path FAILED                         [ 36%]
tests/test_basic.py::test_static_url_path_with_ending_slash FAILED       [ 37%]
tests/test_basic.py::test_static_url_empty_path FAILED                   [ 37%]
tests/test_basic.py::test_static_url_empty_path_default FAILED           [ 38%]
tests/test_basic.py::test_static_folder_with_pathlib_path FAILED         [ 39%]
tests/test_basic.py::test_static_folder_with_ending_slash FAILED         [ 39%]
tests/test_basic.py::test_static_route_with_host_matching FAILED         [ 40%]
tests/test_basic.py::test_request_locals PASSED                          [ 40%]
tests/test_basic.py::test_server_name_subdomain FAILED                   [ 41%]
tests/test_basic.py::test_exception_propagation PASSED                   [ 41%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-True-True] PASSED [ 42%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-True-False] PASSED [ 43%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-False-True] PASSED [ 43%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-False-False] PASSED [ 44%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-True-True] PASSED [ 44%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-True-False] PASSED [ 45%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-False-True] PASSED [ 45%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-False-False] PASSED [ 46%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-True-True] PASSED [ 46%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-True-False] PASSED [ 47%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-False-True] PASSED [ 48%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-False-False] PASSED [ 48%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-True-True] PASSED [ 49%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-True-False] PASSED [ 49%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-False-True] PASSED [ 50%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-False-False] PASSED [ 50%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-True-True] PASSED [ 51%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-True-False] PASSED [ 51%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-False-True] PASSED [ 52%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-False-False] PASSED [ 53%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-True-True] PASSED [ 53%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-True-False] PASSED [ 54%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-False-True] PASSED [ 54%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-False-False] PASSED [ 55%]
tests/test_basic.py::test_max_content_length FAILED                      [ 55%]
tests/test_basic.py::test_url_processors FAILED                          [ 56%]
tests/test_basic.py::test_inject_blueprint_url_defaults FAILED           [ 56%]
tests/test_basic.py::test_nonascii_pathinfo FAILED                       [ 57%]
tests/test_basic.py::test_debug_mode_complains_after_first_request FAILED [ 58%]
tests/test_basic.py::test_before_first_request_functions FAILED          [ 58%]
tests/test_basic.py::test_before_first_request_functions_concurrent FAILED [ 59%]
tests/test_basic.py::test_routing_redirect_debugging FAILED              [ 59%]
tests/test_basic.py::test_route_decorator_custom_endpoint FAILED         [ 60%]
tests/test_basic.py::test_preserve_only_once FAILED                      [ 60%]
tests/test_basic.py::test_preserve_remembers_exception FAILED            [ 61%]
tests/test_basic.py::test_get_method_on_g PASSED                         [ 62%]
tests/test_basic.py::test_g_iteration_protocol PASSED                    [ 62%]
tests/test_basic.py::test_subdomain_basic_support FAILED                 [ 63%]
tests/test_basic.py::test_subdomain_matching FAILED                      [ 63%]
tests/test_basic.py::test_subdomain_matching_with_ports FAILED           [ 64%]
tests/test_basic.py::test_subdomain_matching_other_name[False] FAILED    [ 64%]
tests/test_basic.py::test_subdomain_matching_other_name[True] FAILED     [ 65%]
tests/test_basic.py::test_multi_route_rules FAILED                       [ 65%]
tests/test_basic.py::test_multi_route_class_views FAILED                 [ 66%]
tests/test_basic.py::test_run_defaults PASSED                            [ 67%]
tests/test_basic.py::test_run_server_port PASSED                         [ 67%]
tests/test_basic.py::test_run_from_config[None-None-pocoo.org:8080-pocoo.org-8080] PASSED [ 68%]
tests/test_basic.py::test_run_from_config[localhost-None-pocoo.org:8080-localhost-8080] PASSED [ 68%]
tests/test_basic.py::test_run_from_config[None-80-pocoo.org:8080-pocoo.org-80] PASSED [ 69%]
tests/test_basic.py::test_run_from_config[localhost-80-pocoo.org:8080-localhost-80] PASSED [ 69%]
tests/test_basic.py::test_run_from_config[localhost-0-localhost:8080-localhost-0] PASSED [ 70%]
tests/test_basic.py::test_run_from_config[None-None-localhost:8080-localhost-8080] PASSED [ 70%]
tests/test_basic.py::test_run_from_config[None-None-localhost:0-localhost-0] PASSED [ 71%]
tests/test_basic.py::test_max_cookie_size FAILED                         [ 72%]
tests/test_basic.py::test_app_freed_on_zero_refcount PASSED              [ 72%]
tests/test_blueprints.py::test_blueprint_specific_error_handling FAILED  [ 73%]
tests/test_blueprints.py::test_blueprint_specific_user_error_handling FAILED [ 73%]
tests/test_blueprints.py::test_blueprint_app_error_handling FAILED       [ 74%]
tests/test_blueprints.py::test_blueprint_prefix_slash[-/-/] FAILED       [ 74%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/--/] FAILED       [ 75%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/-/-/] FAILED      [ 75%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo--/foo] FAILED [ 76%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/--/foo/] FAILED [ 77%]
tests/test_blueprints.py::test_blueprint_prefix_slash[-/bar-/bar] FAILED [ 77%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/-/bar-/foo/bar] FAILED [ 78%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/-bar-/foo/bar] FAILED [ 78%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo-/bar-/foo/bar] FAILED [ 79%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/-//bar-/foo/bar] FAILED [ 79%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo//-/bar-/foo/bar] FAILED [ 80%]
tests/test_blueprints.py::test_blueprint_url_defaults FAILED             [ 81%]
tests/test_blueprints.py::test_blueprint_url_processors FAILED           [ 81%]
tests/test_blueprints.py::test_templates_and_static ERROR                [ 82%]
tests/test_blueprints.py::test_default_static_max_age FAILED             [ 82%]
tests/test_blueprints.py::test_templates_list ERROR                      [ 83%]
tests/test_blueprints.py::test_dotted_names FAILED                       [ 83%]
tests/test_blueprints.py::test_dotted_names_from_app FAILED              [ 84%]
tests/test_blueprints.py::test_empty_url_defaults FAILED                 [ 84%]
tests/test_blueprints.py::test_route_decorator_custom_endpoint FAILED    [ 85%]
tests/test_blueprints.py::test_route_decorator_custom_endpoint_with_dots FAILED [ 86%]
tests/test_blueprints.py::test_endpoint_decorator FAILED                 [ 86%]
tests/test_blueprints.py::test_template_filter PASSED                    [ 87%]
tests/test_blueprints.py::test_add_template_filter PASSED                [ 87%]
tests/test_blueprints.py::test_template_filter_with_name PASSED          [ 88%]
tests/test_blueprints.py::test_add_template_filter_with_name PASSED      [ 88%]
tests/test_blueprints.py::test_template_filter_with_template FAILED      [ 89%]
tests/test_blueprints.py::test_template_filter_after_route_with_template FAILED [ 89%]
tests/test_blueprints.py::test_add_template_filter_with_template FAILED  [ 90%]
tests/test_blueprints.py::test_template_filter_with_name_and_template FAILED [ 91%]
tests/test_blueprints.py::test_add_template_filter_with_name_and_template FAILED [ 91%]
tests/test_blueprints.py::test_template_test PASSED                      [ 92%]
tests/test_blueprints.py::test_add_template_test PASSED                  [ 92%]
tests/test_blueprints.py::test_template_test_with_name PASSED            [ 93%]
tests/test_blueprints.py::test_add_template_test_with_name PASSED        [ 93%]
tests/test_blueprints.py::test_template_test_with_template FAILED        [ 94%]
tests/test_blueprints.py::test_template_test_after_route_with_template FAILED [ 94%]
tests/test_blueprints.py::test_add_template_test_with_template FAILED    [ 95%]
tests/test_blueprints.py::test_template_test_with_name_and_template FAILED [ 96%]
tests/test_blueprints.py::test_add_template_test_with_name_and_template FAILED [ 96%]
tests/test_blueprints.py::test_context_processing FAILED                 [ 97%]
tests/test_blueprints.py::test_template_global PASSED                    [ 97%]
tests/test_blueprints.py::test_request_processing FAILED                 [ 98%]
tests/test_blueprints.py::test_app_request_processing FAILED             [ 98%]
tests/test_blueprints.py::test_app_url_processors FAILED                 [ 99%]
tests/test_blueprints.py::test_nested_blueprint FAILED                   [100%]

=========================== short test summary info ============================
PASSED tests/test_basic.py::test_method_route_no_methods
PASSED tests/test_basic.py::test_disallow_string_for_allowed_methods
PASSED tests/test_basic.py::test_error_handler_unknown_code
PASSED tests/test_basic.py::test_request_locals
PASSED tests/test_basic.py::test_exception_propagation
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-True-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-True-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-False-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-False-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-True-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-True-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-False-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-False-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-True-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-True-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-False-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-False-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-True-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-True-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-False-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-False-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-True-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-True-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-False-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-False-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-True-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-True-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-False-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-False-False]
PASSED tests/test_basic.py::test_get_method_on_g
PASSED tests/test_basic.py::test_g_iteration_protocol
PASSED tests/test_basic.py::test_run_defaults
PASSED tests/test_basic.py::test_run_server_port
PASSED tests/test_basic.py::test_run_from_config[None-None-pocoo.org:8080-pocoo.org-8080]
PASSED tests/test_basic.py::test_run_from_config[localhost-None-pocoo.org:8080-localhost-8080]
PASSED tests/test_basic.py::test_run_from_config[None-80-pocoo.org:8080-pocoo.org-80]
PASSED tests/test_basic.py::test_run_from_config[localhost-80-pocoo.org:8080-localhost-80]
PASSED tests/test_basic.py::test_run_from_config[localhost-0-localhost:8080-localhost-0]
PASSED tests/test_basic.py::test_run_from_config[None-None-localhost:8080-localhost-8080]
PASSED tests/test_basic.py::test_run_from_config[None-None-localhost:0-localhost-0]
PASSED tests/test_basic.py::test_app_freed_on_zero_refcount
PASSED tests/test_blueprints.py::test_template_filter
PASSED tests/test_blueprints.py::test_add_template_filter
PASSED tests/test_blueprints.py::test_template_filter_with_name
PASSED tests/test_blueprints.py::test_add_template_filter_with_name
PASSED tests/test_blueprints.py::test_template_test
PASSED tests/test_blueprints.py::test_add_template_test
PASSED tests/test_blueprints.py::test_template_test_with_name
PASSED tests/test_blueprints.py::test_add_template_test_with_name
PASSED tests/test_blueprints.py::test_template_global
ERROR tests/test_basic.py::test_flashes - DeprecationWarning: 'werkzeug.urls....
ERROR tests/test_basic.py::test_make_response - DeprecationWarning: 'werkzeug...
ERROR tests/test_basic.py::test_make_response_with_response_instance - Deprec...
ERROR tests/test_basic.py::test_jsonify_no_prettyprint - DeprecationWarning: ...
ERROR tests/test_basic.py::test_jsonify_prettyprint - DeprecationWarning: 'we...
ERROR tests/test_basic.py::test_jsonify_mimetype - DeprecationWarning: 'werkz...
ERROR tests/test_basic.py::test_json_dump_dataclass - DeprecationWarning: 'we...
ERROR tests/test_basic.py::test_jsonify_args_and_kwargs_check - DeprecationWa...
ERROR tests/test_basic.py::test_url_generation - DeprecationWarning: 'werkzeu...
ERROR tests/test_blueprints.py::test_templates_and_static - DeprecationWarnin...
ERROR tests/test_blueprints.py::test_templates_list - DeprecationWarning: pkg...
FAILED tests/test_basic.py::test_options_work - DeprecationWarning: 'werkzeug...
FAILED tests/test_basic.py::test_options_on_multiple_rules - DeprecationWarni...
FAILED tests/test_basic.py::test_method_route[get] - DeprecationWarning: 'wer...
FAILED tests/test_basic.py::test_method_route[post] - DeprecationWarning: 'we...
FAILED tests/test_basic.py::test_method_route[put] - DeprecationWarning: 'wer...
FAILED tests/test_basic.py::test_method_route[delete] - DeprecationWarning: '...
FAILED tests/test_basic.py::test_method_route[patch] - DeprecationWarning: 'w...
FAILED tests/test_basic.py::test_provide_automatic_options_attr - Deprecation...
FAILED tests/test_basic.py::test_provide_automatic_options_kwarg - Deprecatio...
FAILED tests/test_basic.py::test_request_dispatching - DeprecationWarning: 'w...
FAILED tests/test_basic.py::test_url_mapping - DeprecationWarning: 'werkzeug....
FAILED tests/test_basic.py::test_werkzeug_routing - DeprecationWarning: 'werk...
FAILED tests/test_basic.py::test_endpoint_decorator - DeprecationWarning: 'we...
FAILED tests/test_basic.py::test_session - DeprecationWarning: 'werkzeug.urls...
FAILED tests/test_basic.py::test_session_using_server_name - TypeError: __ini...
FAILED tests/test_basic.py::test_session_using_server_name_and_port - TypeErr...
FAILED tests/test_basic.py::test_session_using_server_name_port_and_path - Ty...
FAILED tests/test_basic.py::test_session_using_application_root - TypeError: ...
FAILED tests/test_basic.py::test_session_using_session_settings - TypeError: ...
FAILED tests/test_basic.py::test_session_using_samesite_attribute - Deprecati...
FAILED tests/test_basic.py::test_session_localhost_warning - TypeError: __ini...
FAILED tests/test_basic.py::test_session_ip_warning - TypeError: __init__() g...
FAILED tests/test_basic.py::test_missing_session - DeprecationWarning: 'werkz...
FAILED tests/test_basic.py::test_session_expiration - DeprecationWarning: 'we...
FAILED tests/test_basic.py::test_session_stored_last - DeprecationWarning: 'w...
FAILED tests/test_basic.py::test_session_special_types - DeprecationWarning: ...
FAILED tests/test_basic.py::test_session_cookie_setting - DeprecationWarning:...
FAILED tests/test_basic.py::test_session_vary_cookie - DeprecationWarning: 'w...
FAILED tests/test_basic.py::test_extended_flashing - DeprecationWarning: 'wer...
FAILED tests/test_basic.py::test_request_processing - DeprecationWarning: 'we...
FAILED tests/test_basic.py::test_request_preprocessing_early_return - Depreca...
FAILED tests/test_basic.py::test_after_request_processing - DeprecationWarnin...
FAILED tests/test_basic.py::test_teardown_request_handler - DeprecationWarnin...
FAILED tests/test_basic.py::test_teardown_request_handler_debug_mode - Deprec...
FAILED tests/test_basic.py::test_teardown_request_handler_error - Deprecation...
FAILED tests/test_basic.py::test_before_after_request_order - DeprecationWarn...
FAILED tests/test_basic.py::test_error_handling - DeprecationWarning: 'werkze...
FAILED tests/test_basic.py::test_error_handling_processing - DeprecationWarni...
FAILED tests/test_basic.py::test_baseexception_error_handling - DeprecationWa...
FAILED tests/test_basic.py::test_before_request_and_routing_errors - Deprecat...
FAILED tests/test_basic.py::test_user_error_handling - DeprecationWarning: 'w...
FAILED tests/test_basic.py::test_http_error_subclass_handling - DeprecationWa...
FAILED tests/test_basic.py::test_errorhandler_precedence - DeprecationWarning...
FAILED tests/test_basic.py::test_trapping_of_bad_request_key_errors - Depreca...
FAILED tests/test_basic.py::test_trapping_of_all_http_exceptions - Deprecatio...
FAILED tests/test_basic.py::test_error_handler_after_processor_error - Deprec...
FAILED tests/test_basic.py::test_enctype_debug_helper - DeprecationWarning: '...
FAILED tests/test_basic.py::test_response_types - DeprecationWarning: 'werkze...
FAILED tests/test_basic.py::test_response_type_errors - DeprecationWarning: '...
FAILED tests/test_basic.py::test_build_error_handler - DeprecationWarning: 'w...
FAILED tests/test_basic.py::test_build_error_handler_reraise - DeprecationWar...
FAILED tests/test_basic.py::test_url_for_passes_special_values_to_build_error_handler
FAILED tests/test_basic.py::test_static_files - DeprecationWarning: 'werkzeug...
FAILED tests/test_basic.py::test_static_url_path - DeprecationWarning: 'werkz...
FAILED tests/test_basic.py::test_static_url_path_with_ending_slash - Deprecat...
FAILED tests/test_basic.py::test_static_url_empty_path - DeprecationWarning: ...
FAILED tests/test_basic.py::test_static_url_empty_path_default - DeprecationW...
FAILED tests/test_basic.py::test_static_folder_with_pathlib_path - Deprecatio...
FAILED tests/test_basic.py::test_static_folder_with_ending_slash - Deprecatio...
FAILED tests/test_basic.py::test_static_route_with_host_matching - Deprecatio...
FAILED tests/test_basic.py::test_server_name_subdomain - DeprecationWarning: ...
FAILED tests/test_basic.py::test_max_content_length - DeprecationWarning: 'we...
FAILED tests/test_basic.py::test_url_processors - DeprecationWarning: 'werkze...
FAILED tests/test_basic.py::test_inject_blueprint_url_defaults - AssertionErr...
FAILED tests/test_basic.py::test_nonascii_pathinfo - DeprecationWarning: 'wer...
FAILED tests/test_basic.py::test_debug_mode_complains_after_first_request - D...
FAILED tests/test_basic.py::test_before_first_request_functions - Deprecation...
FAILED tests/test_basic.py::test_before_first_request_functions_concurrent - ...
FAILED tests/test_basic.py::test_routing_redirect_debugging - DeprecationWarn...
FAILED tests/test_basic.py::test_route_decorator_custom_endpoint - Deprecatio...
FAILED tests/test_basic.py::test_preserve_only_once - DeprecationWarning: 'we...
FAILED tests/test_basic.py::test_preserve_remembers_exception - DeprecationWa...
FAILED tests/test_basic.py::test_subdomain_basic_support - TypeError: __init_...
FAILED tests/test_basic.py::test_subdomain_matching - TypeError: __init__() g...
FAILED tests/test_basic.py::test_subdomain_matching_with_ports - TypeError: _...
FAILED tests/test_basic.py::test_subdomain_matching_other_name[False] - TypeE...
FAILED tests/test_basic.py::test_subdomain_matching_other_name[True] - TypeEr...
FAILED tests/test_basic.py::test_multi_route_rules - DeprecationWarning: 'wer...
FAILED tests/test_basic.py::test_multi_route_class_views - DeprecationWarning...
FAILED tests/test_basic.py::test_max_cookie_size - TypeError: __init__() got ...
FAILED tests/test_blueprints.py::test_blueprint_specific_error_handling - Dep...
FAILED tests/test_blueprints.py::test_blueprint_specific_user_error_handling
FAILED tests/test_blueprints.py::test_blueprint_app_error_handling - Deprecat...
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[-/-/] - Deprecat...
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/--/] - Deprecat...
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/-/-/] - Depreca...
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/foo--/foo] - De...
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/--/foo/] - ...
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[-/bar-/bar] - De...
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/-/bar-/foo/bar]
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/-bar-/foo/bar]
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/foo-/bar-/foo/bar]
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/-//bar-/foo/bar]
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/foo//-/bar-/foo/bar]
FAILED tests/test_blueprints.py::test_blueprint_url_defaults - DeprecationWar...
FAILED tests/test_blueprints.py::test_blueprint_url_processors - DeprecationW...
FAILED tests/test_blueprints.py::test_default_static_max_age - DeprecationWar...
FAILED tests/test_blueprints.py::test_dotted_names - AssertionError: Blueprin...
FAILED tests/test_blueprints.py::test_dotted_names_from_app - DeprecationWarn...
FAILED tests/test_blueprints.py::test_empty_url_defaults - DeprecationWarning...
FAILED tests/test_blueprints.py::test_route_decorator_custom_endpoint - Depre...
FAILED tests/test_blueprints.py::test_route_decorator_custom_endpoint_with_dots
FAILED tests/test_blueprints.py::test_endpoint_decorator - DeprecationWarning...
FAILED tests/test_blueprints.py::test_template_filter_with_template - Depreca...
FAILED tests/test_blueprints.py::test_template_filter_after_route_with_template
FAILED tests/test_blueprints.py::test_add_template_filter_with_template - Dep...
FAILED tests/test_blueprints.py::test_template_filter_with_name_and_template
FAILED tests/test_blueprints.py::test_add_template_filter_with_name_and_template
FAILED tests/test_blueprints.py::test_template_test_with_template - Deprecati...
FAILED tests/test_blueprints.py::test_template_test_after_route_with_template
FAILED tests/test_blueprints.py::test_add_template_test_with_template - Depre...
FAILED tests/test_blueprints.py::test_template_test_with_name_and_template - ...
FAILED tests/test_blueprints.py::test_add_template_test_with_name_and_template
FAILED tests/test_blueprints.py::test_context_processing - DeprecationWarning...
FAILED tests/test_blueprints.py::test_request_processing - DeprecationWarning...
FAILED tests/test_blueprints.py::test_app_request_processing - DeprecationWar...
FAILED tests/test_blueprints.py::test_app_url_processors - DeprecationWarning...
FAILED tests/test_blueprints.py::test_nested_blueprint - DeprecationWarning: ...
================== 118 failed, 50 passed, 11 errors in 0.85s ===================

</test-errors>

<file>
<path>src/flask/blueprints.py</path>
<content>
1: import typing as t
2: from collections import defaultdict
3: from functools import update_wrapper
4: 
5: from .scaffold import _endpoint_from_view_func
6: from .scaffold import _sentinel
7: from .scaffold import Scaffold
8: from .typing import AfterRequestCallable
9: from .typing import BeforeRequestCallable
10: from .typing import ErrorHandlerCallable
11: from .typing import TeardownCallable
12: from .typing import TemplateContextProcessorCallable
13: from .typing import TemplateFilterCallable
14: from .typing import TemplateGlobalCallable
15: from .typing import TemplateTestCallable
16: from .typing import URLDefaultCallable
17: from .typing import URLValuePreprocessorCallable
18: 
19: if t.TYPE_CHECKING:
20:     from .app import Flask
21: 
22: DeferredSetupFunction = t.Callable[["BlueprintSetupState"], t.Callable]
23: 
24: 
25: class BlueprintSetupState:
26:     """Temporary holder object for registering a blueprint with the
27:     application.  An instance of this class is created by the
28:     :meth:`~flask.Blueprint.make_setup_state` method and later passed
29:     to all register callback functions.
30:     """
31: 
32:     def __init__(
33:         self,
34:         blueprint: "Blueprint",
35:         app: "Flask",
36:         options: t.Any,
37:         first_registration: bool,
38:     ) -> None:
39:         #: a reference to the current application
40:         self.app = app
41: 
42:         #: a reference to the blueprint that created this setup state.
43:         self.blueprint = blueprint
44: 
45:         #: a dictionary with all options that were passed to the
46:         #: :meth:`~flask.Flask.register_blueprint` method.
47:         self.options = options
48: 
49:         #: as blueprints can be registered multiple times with the
50:         #: application and not everything wants to be registered
51:         #: multiple times on it, this attribute can be used to figure
52:         #: out if the blueprint was registered in the past already.
53:         self.first_registration = first_registration
54: 
55:         subdomain = self.options.get("subdomain")
56:         if subdomain is None:
57:             subdomain = self.blueprint.subdomain
58: 
59:         #: The subdomain that the blueprint should be active for, ``None``
60:         #: otherwise.
61:         self.subdomain = subdomain
62: 
63:         url_prefix = self.options.get("url_prefix")
64:         if url_prefix is None:
65:             url_prefix = self.blueprint.url_prefix
66:         #: The prefix that should be used for all URLs defined on the
67:         #: blueprint.
68:         self.url_prefix = url_prefix
69: 
70:         self.name_prefix = self.options.get("name_prefix", "")
71: 
72:         #: A dictionary with URL defaults that is added to each and every
73:         #: URL that was defined with the blueprint.
74:         self.url_defaults = dict(self.blueprint.url_values_defaults)
75:         self.url_defaults.update(self.options.get("url_defaults", ()))
76: 
77:     def add_url_rule(
78:         self,
79:         rule: str,
80:         endpoint: t.Optional[str] = None,
81:         view_func: t.Optional[t.Callable] = None,
82:         **options: t.Any,
83:     ) -> None:
84:         """A helper method to register a rule (and optionally a view function)
85:         to the application.  The endpoint is automatically prefixed with the
86:         blueprint's name.
87:         """
88:         if self.url_prefix is not None:
89:             if rule:
90:                 rule = "/".join((self.url_prefix.rstrip("/"), rule.lstrip("/")))
91:             else:
92:                 rule = self.url_prefix
93:         options.setdefault("subdomain", self.subdomain)
94:         if endpoint is None:
95:             endpoint = _endpoint_from_view_func(view_func)  # type: ignore
96:         defaults = self.url_defaults
97:         if "defaults" in options:
98:             defaults = dict(defaults, **options.pop("defaults"))
99:         self.app.add_url_rule(
100:             rule,
101:             f"{self.name_prefix}{self.blueprint.name}.{endpoint}",
102:             view_func,
103:             defaults=defaults,
104:             **options,
105:         )
106: 
107: 
108: class Blueprint(Scaffold):
109:     """Represents a blueprint, a collection of routes and other
110:     app-related functions that can be registered on a real application
111:     later.
112: 
113:     A blueprint is an object that allows defining application functions
114:     without requiring an application object ahead of time. It uses the
115:     same decorators as :class:`~flask.Flask`, but defers the need for an
116:     application by recording them for later registration.
117: 
118:     Decorating a function with a blueprint creates a deferred function
119:     that is called with :class:`~flask.blueprints.BlueprintSetupState`
120:     when the blueprint is registered on an application.
121: 
122:     See :doc:`/blueprints` for more information.
123: 
124:     :param name: The name of the blueprint. Will be prepended to each
125:         endpoint name.
126:     :param import_name: The name of the blueprint package, usually
127:         ``__name__``. This helps locate the ``root_path`` for the
128:         blueprint.
129:     :param static_folder: A folder with static files that should be
130:         served by the blueprint's static route. The path is relative to
131:         the blueprint's root path. Blueprint static files are disabled
132:         by default.
133:     :param static_url_path: The url to serve static files from.
134:         Defaults to ``static_folder``. If the blueprint does not have
135:         a ``url_prefix``, the app's static route will take precedence,
136:         and the blueprint's static files won't be accessible.
137:     :param template_folder: A folder with templates that should be added
138:         to the app's template search path. The path is relative to the
139:         blueprint's root path. Blueprint templates are disabled by
140:         default. Blueprint templates have a lower precedence than those
141:         in the app's templates folder.
142:     :param url_prefix: A path to prepend to all of the blueprint's URLs,
143:         to make them distinct from the rest of the app's routes.
144:     :param subdomain: A subdomain that blueprint routes will match on by
145:         default.
146:     :param url_defaults: A dict of default values that blueprint routes
147:         will receive by default.
148:     :param root_path: By default, the blueprint will automatically set
149:         this based on ``import_name``. In certain situations this
150:         automatic detection can fail, so the path can be specified
151:         manually instead.
152: 
153:     .. versionchanged:: 1.1.0
154:         Blueprints have a ``cli`` group to register nested CLI commands.
155:         The ``cli_group`` parameter controls the name of the group under
156:         the ``flask`` command.
157: 
158:     .. versionadded:: 0.7
159:     """
160: 
161:     warn_on_modifications = False
162:     _got_registered_once = False
163: 
164:     #: Blueprint local JSON encoder class to use. Set to ``None`` to use
165:     #: the app's :class:`~flask.Flask.json_encoder`.
166:     json_encoder = None
167:     #: Blueprint local JSON decoder class to use. Set to ``None`` to use
168:     #: the app's :class:`~flask.Flask.json_decoder`.
169:     json_decoder = None
170: 
171:     def __init__(
172:         self,
173:         name: str,
174:         import_name: str,
175:         static_folder: t.Optional[str] = None,
176:         static_url_path: t.Optional[str] = None,
177:         template_folder: t.Optional[str] = None,
178:         url_prefix: t.Optional[str] = None,
179:         subdomain: t.Optional[str] = None,
180:         url_defaults: t.Optional[dict] = None,
181:         root_path: t.Optional[str] = None,
182:         cli_group: t.Optional[str] = _sentinel,  # type: ignore
183:     ):
184:         super().__init__(
185:             import_name=import_name,
186:             static_folder=static_folder,
187:             static_url_path=static_url_path,
188:             template_folder=template_folder,
189:             root_path=root_path,
190:         )
191:         assert '.' not in name, "Blueprint name should not contain dots, as they are reserved for nesting."
192:         self.name = name
193:         self.url_prefix = url_prefix
194:         self.subdomain = subdomain
195:         self.deferred_functions: t.List[DeferredSetupFunction] = []
196: 
197:         if url_defaults is None:
198:             url_defaults = {}
199: 
200:         self.url_values_defaults = url_defaults
201:         self.cli_group = cli_group
202:         self._blueprints: t.List[t.Tuple["Blueprint", dict]] = []
203: 
204:     def _is_setup_finished(self) -> bool:
205:         return self.warn_on_modifications and self._got_registered_once
206: 
207:     def record(self, func: t.Callable) -> None:
208:         """Registers a function that is called when the blueprint is
209:         registered on the application.  This function is called with the
210:         state as argument as returned by the :meth:`make_setup_state`
211:         method.
212:         """
213:         if self._got_registered_once and self.warn_on_modifications:
214:             from warnings import warn
215: 
216:             warn(
217:                 Warning(
218:                     "The blueprint was already registered once but is"
219:                     " getting modified now. These changes will not show"
220:                     " up."
221:                 )
222:             )
223:         self.deferred_functions.append(func)
224: 
225:     def record_once(self, func: t.Callable) -> None:
226:         """Works like :meth:`record` but wraps the function in another
227:         function that will ensure the function is only called once.  If the
228:         blueprint is registered a second time on the application, the
229:         function passed is not called.
230:         """
231: 
232:         def wrapper(state: BlueprintSetupState) -> None:
233:             if state.first_registration:
234:                 func(state)
235: 
236:         return self.record(update_wrapper(wrapper, func))
237: 
238:     def make_setup_state(
239:         self, app: "Flask", options: dict, first_registration: bool = False
240:     ) -> BlueprintSetupState:
241:         """Creates an instance of :meth:`~flask.blueprints.BlueprintSetupState`
242:         object that is later passed to the register callback functions.
243:         Subclasses can override this to return a subclass of the setup state.
244:         """
245:         return BlueprintSetupState(self, app, options, first_registration)
246: 
247:     def register_blueprint(self, blueprint: "Blueprint", **options: t.Any) -> None:
248:         """Register a :class:`~flask.Blueprint` on this blueprint. Keyword
249:         arguments passed to this method will override the defaults set
250:         on the blueprint.
251: 
252:         .. versionadded:: 2.0
253:         """
254:         self._blueprints.append((blueprint, options))
255: 
256:     def register(self, app: "Flask", options: dict) -> None:
257:         """Called by :meth:`Flask.register_blueprint` to register all
258:         views and callbacks registered on the blueprint with the
259:         application. Creates a :class:`.BlueprintSetupState` and calls
260:         each :meth:`record` callbackwith it.
261: 
262:         :param app: The application this blueprint is being registered
263:             with.
264:         :param options: Keyword arguments forwarded from
265:             :meth:`~Flask.register_blueprint`.
266:         :param first_registration: Whether this is the first time this
267:             blueprint has been registered on the application.
268:         """
269:         first_registration = False
270: 
271:         if self.name in app.blueprints:
272:             assert app.blueprints[self.name] is self, (
273:                 "A name collision occurred between blueprints"
274:                 f" {self!r} and {app.blueprints[self.name]!r}."
275:                 f" Both share the same name {self.name!r}."
276:                 f" Blueprints that are created on the fly need unique"
277:                 f" names."
278:             )
279:         else:
280:             app.blueprints[self.name] = self
281:             first_registration = True
282: 
283:         self._got_registered_once = True
284:         state = self.make_setup_state(app, options, first_registration)
285: 
286:         if self.has_static_folder:
287:             state.add_url_rule(
288:                 f"{self.static_url_path}/<path:filename>",
289:                 view_func=self.send_static_file,
290:                 endpoint="static",
291:             )
292: 
293:         # Merge blueprint data into parent.
294:         if first_registration:
295: 
296:             def extend(bp_dict, parent_dict):
297:                 for key, values in bp_dict.items():
298:                     key = self.name if key is None else f"{self.name}.{key}"
299: 
300:                     parent_dict[key].extend(values)
301: 
302:             for key, value in self.error_handler_spec.items():
303:                 key = self.name if key is None else f"{self.name}.{key}"
304:                 value = defaultdict(
305:                     dict,
306:                     {
307:                         code: {
308:                             exc_class: func for exc_class, func in code_values.items()
309:                         }
310:                         for code, code_values in value.items()
311:                     },
312:                 )
313:                 app.error_handler_spec[key] = value
314: 
315:             for endpoint, func in self.view_functions.items():
316:                 app.view_functions[endpoint] = func
317: 
318:             extend(self.before_request_funcs, app.before_request_funcs)
319:             extend(self.after_request_funcs, app.after_request_funcs)
320:             extend(
321:                 self.teardown_request_funcs,
322:                 app.teardown_request_funcs,
323:             )
324:             extend(self.url_default_functions, app.url_default_functions)
325:             extend(self.url_value_preprocessors, app.url_value_preprocessors)
326:             extend(self.template_context_processors, app.template_context_processors)
327: 
328:         for deferred in self.deferred_functions:
329:             deferred(state)
330: 
331:         cli_resolved_group = options.get("cli_group", self.cli_group)
332: 
333:         if self.cli.commands:
334:             if cli_resolved_group is None:
335:                 app.cli.commands.update(self.cli.commands)
336:             elif cli_resolved_group is _sentinel:
337:                 self.cli.name = self.name
338:                 app.cli.add_command(self.cli)
339:             else:
340:                 self.cli.name = cli_resolved_group
341:                 app.cli.add_command(self.cli)
342: 
343:         for blueprint, bp_options in self._blueprints:
344:             url_prefix = options.get("url_prefix", "")
345:             if "url_prefix" in bp_options:
346:                 url_prefix = (
347:                     url_prefix.rstrip("/") + "/" + bp_options["url_prefix"].lstrip("/")
348:                 )
349: 
350:             bp_options["url_prefix"] = url_prefix
351:             bp_options["name_prefix"] = options.get("name_prefix", "") + self.name + "."
352:             blueprint.register(app, bp_options)
353: 
354:     def add_url_rule(
355:         self,
356:         rule: str,
357:         endpoint: t.Optional[str] = None,
358:         view_func: t.Optional[t.Callable] = None,
359:         **options: t.Any,
360:     ) -> None:
361:         """Like :meth:`Flask.add_url_rule` but for a blueprint.  The endpoint for
362:         the :func:`url_for` function is prefixed with the name of the blueprint.
363:         """
364:         if endpoint:
365:             assert "." not in endpoint, "Blueprint endpoints should not contain dots"
366:         if view_func and hasattr(view_func, "__name__"):
367:             assert (
368:                 "." not in view_func.__name__
369:             ), "Blueprint view function name should not contain dots"
370:         self.record(lambda s: s.add_url_rule(rule, endpoint, view_func, **options))
371: 
372:     def app_template_filter(self, name: t.Optional[str] = None) -> t.Callable:
373:         """Register a custom template filter, available application wide.  Like
374:         :meth:`Flask.template_filter` but for a blueprint.
375: 
376:         :param name: the optional name of the filter, otherwise the
377:                      function name will be used.
378:         """
379: 
380:         def decorator(f: TemplateFilterCallable) -> TemplateFilterCallable:
381:             self.add_app_template_filter(f, name=name)
382:             return f
383: 
384:         return decorator
385: 
386:     def add_app_template_filter(
387:         self, f: TemplateFilterCallable, name: t.Optional[str] = None
388:     ) -> None:
389:         """Register a custom template filter, available application wide.  Like
390:         :meth:`Flask.add_template_filter` but for a blueprint.  Works exactly
391:         like the :meth:`app_template_filter` decorator.
392: 
393:         :param name: the optional name of the filter, otherwise the
394:                      function name will be used.
395:         """
396: 
397:         def register_template(state: BlueprintSetupState) -> None:
398:             state.app.jinja_env.filters[name or f.__name__] = f
399: 
400:         self.record_once(register_template)
401: 
402:     def app_template_test(self, name: t.Optional[str] = None) -> t.Callable:
403:         """Register a custom template test, available application wide.  Like
404:         :meth:`Flask.template_test` but for a blueprint.
405: 
406:         .. versionadded:: 0.10
407: 
408:         :param name: the optional name of the test, otherwise the
409:                      function name will be used.
410:         """
411: 
412:         def decorator(f: TemplateTestCallable) -> TemplateTestCallable:
413:             self.add_app_template_test(f, name=name)
414:             return f
415: 
416:         return decorator
417: 
418:     def add_app_template_test(
419:         self, f: TemplateTestCallable, name: t.Optional[str] = None
420:     ) -> None:
421:         """Register a custom template test, available application wide.  Like
422:         :meth:`Flask.add_template_test` but for a blueprint.  Works exactly
423:         like the :meth:`app_template_test` decorator.
424: 
425:         .. versionadded:: 0.10
426: 
427:         :param name: the optional name of the test, otherwise the
428:                      function name will be used.
429:         """
430: 
431:         def register_template(state: BlueprintSetupState) -> None:
432:             state.app.jinja_env.tests[name or f.__name__] = f
433: 
434:         self.record_once(register_template)
435: 
436:     def app_template_global(self, name: t.Optional[str] = None) -> t.Callable:
437:         """Register a custom template global, available application wide.  Like
438:         :meth:`Flask.template_global` but for a blueprint.
439: 
440:         .. versionadded:: 0.10
441: 
442:         :param name: the optional name of the global, otherwise the
443:                      function name will be used.
444:         """
445: 
446:         def decorator(f: TemplateGlobalCallable) -> TemplateGlobalCallable:
447:             self.add_app_template_global(f, name=name)
448:             return f
449: 
450:         return decorator
451: 
452:     def add_app_template_global(
453:         self, f: TemplateGlobalCallable, name: t.Optional[str] = None
454:     ) -> None:
455:         """Register a custom template global, available application wide.  Like
456:         :meth:`Flask.add_template_global` but for a blueprint.  Works exactly
457:         like the :meth:`app_template_global` decorator.
458: 
459:         .. versionadded:: 0.10
460: 
461:         :param name: the optional name of the global, otherwise the
462:                      function name will be used.
463:         """
464: 
465:         def register_template(state: BlueprintSetupState) -> None:
466:             state.app.jinja_env.globals[name or f.__name__] = f
467: 
468:         self.record_once(register_template)
469: 
470:     def before_app_request(self, f: BeforeRequestCallable) -> BeforeRequestCallable:
471:         """Like :meth:`Flask.before_request`.  Such a function is executed
472:         before each request, even if outside of a blueprint.
473:         """
474:         self.record_once(
475:             lambda s: s.app.before_request_funcs.setdefault(None, []).append(f)
476:         )
477:         return f
478: 
479:     def before_app_first_request(
480:         self, f: BeforeRequestCallable
481:     ) -> BeforeRequestCallable:
482:         """Like :meth:`Flask.before_first_request`.  Such a function is
483:         executed before the first request to the application.
484:         """
485:         self.record_once(lambda s: s.app.before_first_request_funcs.append(f))
486:         return f
487: 
488:     def after_app_request(self, f: AfterRequestCallable) -> AfterRequestCallable:
489:         """Like :meth:`Flask.after_request` but for a blueprint.  Such a function
490:         is executed after each request, even if outside of the blueprint.
491:         """
492:         self.record_once(
493:             lambda s: s.app.after_request_funcs.setdefault(None, []).append(f)
494:         )
495:         return f
496: 
497:     def teardown_app_request(self, f: TeardownCallable) -> TeardownCallable:
498:         """Like :meth:`Flask.teardown_request` but for a blueprint.  Such a
499:         function is executed when tearing down each request, even if outside of
500:         the blueprint.
501:         """
502:         self.record_once(
503:             lambda s: s.app.teardown_request_funcs.setdefault(None, []).append(f)
504:         )
505:         return f
506: 
507:     def app_context_processor(
508:         self, f: TemplateContextProcessorCallable
509:     ) -> TemplateContextProcessorCallable:
510:         """Like :meth:`Flask.context_processor` but for a blueprint.  Such a
511:         function is executed each request, even if outside of the blueprint.
512:         """
513:         self.record_once(
514:             lambda s: s.app.template_context_processors.setdefault(None, []).append(f)
515:         )
516:         return f
517: 
518:     def app_errorhandler(self, code: t.Union[t.Type[Exception], int]) -> t.Callable:
519:         """Like :meth:`Flask.errorhandler` but for a blueprint.  This
520:         handler is used for all requests, even if outside of the blueprint.
521:         """
522: 
523:         def decorator(f: ErrorHandlerCallable) -> ErrorHandlerCallable:
524:             self.record_once(lambda s: s.app.errorhandler(code)(f))
525:             return f
526: 
527:         return decorator
528: 
529:     def app_url_value_preprocessor(
530:         self, f: URLValuePreprocessorCallable
531:     ) -> URLValuePreprocessorCallable:
532:         """Same as :meth:`url_value_preprocessor` but application wide."""
533:         self.record_once(
534:             lambda s: s.app.url_value_preprocessors.setdefault(None, []).append(f)
535:         )
536:         return f
537: 
538:     def app_url_defaults(self, f: URLDefaultCallable) -> URLDefaultCallable:
539:         """Same as :meth:`url_defaults` but application wide."""
540:         self.record_once(
541:             lambda s: s.app.url_default_functions.setdefault(None, []).append(f)
542:         )
543:         return f
544: 
</content>
</file>
