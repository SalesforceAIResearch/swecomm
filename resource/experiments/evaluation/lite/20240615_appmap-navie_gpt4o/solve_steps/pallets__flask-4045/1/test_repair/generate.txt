@generate /noformat

<test-errors>
activate successful
CONDA_EXE=/usr/share/miniconda/bin/conda
_CE_M=
PWD=/home/runner/work/_temp/tmpdw7lpya2/pallets__flask__2.0-3
CONDA_PREFIX=/usr/share/miniconda/envs/pallets__flask__2.0-3
CONDA_PROMPT_MODIFIER=(pallets__flask__2.0-3) 
_CE_CONDA=
CONDA_SHLVL=1
SHLVL=1
CONDA_PYTHON_EXE=/usr/share/miniconda/bin/python
CONDA_DEFAULT_ENV=pallets__flask__2.0-3
CONDA_PKGS_DIRS=/usr/share/miniconda/cache
PATH=/usr/share/miniconda/envs/pallets__flask__2.0-3/bin:/usr/share/miniconda/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
_=/usr/bin/printenv
============================= test session starts ==============================
collecting ... collected 179 items

tests/test_basic.py::test_options_work FAILED                            [  0%]
tests/test_basic.py::test_options_on_multiple_rules FAILED               [  1%]
tests/test_basic.py::test_method_route[get] FAILED                       [  1%]
tests/test_basic.py::test_method_route[post] FAILED                      [  2%]
tests/test_basic.py::test_method_route[put] FAILED                       [  2%]
tests/test_basic.py::test_method_route[delete] FAILED                    [  3%]
tests/test_basic.py::test_method_route[patch] FAILED                     [  3%]
tests/test_basic.py::test_method_route_no_methods PASSED                 [  4%]
tests/test_basic.py::test_provide_automatic_options_attr FAILED          [  5%]
tests/test_basic.py::test_provide_automatic_options_kwarg FAILED         [  5%]
tests/test_basic.py::test_request_dispatching FAILED                     [  6%]
tests/test_basic.py::test_disallow_string_for_allowed_methods PASSED     [  6%]
tests/test_basic.py::test_url_mapping FAILED                             [  7%]
tests/test_basic.py::test_werkzeug_routing FAILED                        [  7%]
tests/test_basic.py::test_endpoint_decorator FAILED                      [  8%]
tests/test_basic.py::test_session FAILED                                 [  8%]
tests/test_basic.py::test_session_using_server_name FAILED               [  9%]
tests/test_basic.py::test_session_using_server_name_and_port FAILED      [ 10%]
tests/test_basic.py::test_session_using_server_name_port_and_path FAILED [ 10%]
tests/test_basic.py::test_session_using_application_root FAILED          [ 11%]
tests/test_basic.py::test_session_using_session_settings FAILED          [ 11%]
tests/test_basic.py::test_session_using_samesite_attribute FAILED        [ 12%]
tests/test_basic.py::test_session_localhost_warning FAILED               [ 12%]
tests/test_basic.py::test_session_ip_warning FAILED                      [ 13%]
tests/test_basic.py::test_missing_session FAILED                         [ 13%]
tests/test_basic.py::test_session_expiration FAILED                      [ 14%]
tests/test_basic.py::test_session_stored_last FAILED                     [ 15%]
tests/test_basic.py::test_session_special_types FAILED                   [ 15%]
tests/test_basic.py::test_session_cookie_setting FAILED                  [ 16%]
tests/test_basic.py::test_session_vary_cookie FAILED                     [ 16%]
tests/test_basic.py::test_flashes ERROR                                  [ 17%]
tests/test_basic.py::test_extended_flashing FAILED                       [ 17%]
tests/test_basic.py::test_request_processing FAILED                      [ 18%]
tests/test_basic.py::test_request_preprocessing_early_return FAILED      [ 18%]
tests/test_basic.py::test_after_request_processing FAILED                [ 19%]
tests/test_basic.py::test_teardown_request_handler FAILED                [ 20%]
tests/test_basic.py::test_teardown_request_handler_debug_mode FAILED     [ 20%]
tests/test_basic.py::test_teardown_request_handler_error FAILED          [ 21%]
tests/test_basic.py::test_before_after_request_order FAILED              [ 21%]
tests/test_basic.py::test_error_handling FAILED                          [ 22%]
tests/test_basic.py::test_error_handler_unknown_code PASSED              [ 22%]
tests/test_basic.py::test_error_handling_processing FAILED               [ 23%]
tests/test_basic.py::test_baseexception_error_handling FAILED            [ 24%]
tests/test_basic.py::test_before_request_and_routing_errors FAILED       [ 24%]
tests/test_basic.py::test_user_error_handling FAILED                     [ 25%]
tests/test_basic.py::test_http_error_subclass_handling FAILED            [ 25%]
tests/test_basic.py::test_errorhandler_precedence FAILED                 [ 26%]
tests/test_basic.py::test_trapping_of_bad_request_key_errors FAILED      [ 26%]
tests/test_basic.py::test_trapping_of_all_http_exceptions FAILED         [ 27%]
tests/test_basic.py::test_error_handler_after_processor_error FAILED     [ 27%]
tests/test_basic.py::test_enctype_debug_helper FAILED                    [ 28%]
tests/test_basic.py::test_response_types FAILED                          [ 29%]
tests/test_basic.py::test_response_type_errors FAILED                    [ 29%]
tests/test_basic.py::test_make_response ERROR                            [ 30%]
tests/test_basic.py::test_make_response_with_response_instance ERROR     [ 30%]
tests/test_basic.py::test_jsonify_no_prettyprint ERROR                   [ 31%]
tests/test_basic.py::test_jsonify_prettyprint ERROR                      [ 31%]
tests/test_basic.py::test_jsonify_mimetype ERROR                         [ 32%]
tests/test_basic.py::test_json_dump_dataclass ERROR                      [ 32%]
tests/test_basic.py::test_jsonify_args_and_kwargs_check ERROR            [ 33%]
tests/test_basic.py::test_url_generation ERROR                           [ 34%]
tests/test_basic.py::test_build_error_handler FAILED                     [ 34%]
tests/test_basic.py::test_build_error_handler_reraise FAILED             [ 35%]
tests/test_basic.py::test_url_for_passes_special_values_to_build_error_handler FAILED [ 35%]
tests/test_basic.py::test_static_files FAILED                            [ 36%]
tests/test_basic.py::test_static_url_path FAILED                         [ 36%]
tests/test_basic.py::test_static_url_path_with_ending_slash FAILED       [ 37%]
tests/test_basic.py::test_static_url_empty_path FAILED                   [ 37%]
tests/test_basic.py::test_static_url_empty_path_default FAILED           [ 38%]
tests/test_basic.py::test_static_folder_with_pathlib_path FAILED         [ 39%]
tests/test_basic.py::test_static_folder_with_ending_slash FAILED         [ 39%]
tests/test_basic.py::test_static_route_with_host_matching FAILED         [ 40%]
tests/test_basic.py::test_request_locals PASSED                          [ 40%]
tests/test_basic.py::test_server_name_subdomain FAILED                   [ 41%]
tests/test_basic.py::test_exception_propagation PASSED                   [ 41%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-True-True] PASSED [ 42%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-True-False] PASSED [ 43%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-False-True] PASSED [ 43%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-False-False] PASSED [ 44%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-True-True] PASSED [ 44%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-True-False] PASSED [ 45%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-False-True] PASSED [ 45%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-False-False] PASSED [ 46%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-True-True] PASSED [ 46%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-True-False] PASSED [ 47%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-False-True] PASSED [ 48%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-False-False] PASSED [ 48%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-True-True] PASSED [ 49%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-True-False] PASSED [ 49%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-False-True] PASSED [ 50%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-False-False] PASSED [ 50%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-True-True] PASSED [ 51%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-True-False] PASSED [ 51%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-False-True] PASSED [ 52%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-False-False] PASSED [ 53%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-True-True] PASSED [ 53%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-True-False] PASSED [ 54%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-False-True] PASSED [ 54%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-False-False] PASSED [ 55%]
tests/test_basic.py::test_max_content_length FAILED                      [ 55%]
tests/test_basic.py::test_url_processors FAILED                          [ 56%]
tests/test_basic.py::test_inject_blueprint_url_defaults FAILED           [ 56%]
tests/test_basic.py::test_nonascii_pathinfo FAILED                       [ 57%]
tests/test_basic.py::test_debug_mode_complains_after_first_request FAILED [ 58%]
tests/test_basic.py::test_before_first_request_functions FAILED          [ 58%]
tests/test_basic.py::test_before_first_request_functions_concurrent FAILED [ 59%]
tests/test_basic.py::test_routing_redirect_debugging FAILED              [ 59%]
tests/test_basic.py::test_route_decorator_custom_endpoint FAILED         [ 60%]
tests/test_basic.py::test_preserve_only_once FAILED                      [ 60%]
tests/test_basic.py::test_preserve_remembers_exception FAILED            [ 61%]
tests/test_basic.py::test_get_method_on_g PASSED                         [ 62%]
tests/test_basic.py::test_g_iteration_protocol PASSED                    [ 62%]
tests/test_basic.py::test_subdomain_basic_support FAILED                 [ 63%]
tests/test_basic.py::test_subdomain_matching FAILED                      [ 63%]
tests/test_basic.py::test_subdomain_matching_with_ports FAILED           [ 64%]
tests/test_basic.py::test_subdomain_matching_other_name[False] FAILED    [ 64%]
tests/test_basic.py::test_subdomain_matching_other_name[True] FAILED     [ 65%]
tests/test_basic.py::test_multi_route_rules FAILED                       [ 65%]
tests/test_basic.py::test_multi_route_class_views FAILED                 [ 66%]
tests/test_basic.py::test_run_defaults PASSED                            [ 67%]
tests/test_basic.py::test_run_server_port PASSED                         [ 67%]
tests/test_basic.py::test_run_from_config[None-None-pocoo.org:8080-pocoo.org-8080] PASSED [ 68%]
tests/test_basic.py::test_run_from_config[localhost-None-pocoo.org:8080-localhost-8080] PASSED [ 68%]
tests/test_basic.py::test_run_from_config[None-80-pocoo.org:8080-pocoo.org-80] PASSED [ 69%]
tests/test_basic.py::test_run_from_config[localhost-80-pocoo.org:8080-localhost-80] PASSED [ 69%]
tests/test_basic.py::test_run_from_config[localhost-0-localhost:8080-localhost-0] PASSED [ 70%]
tests/test_basic.py::test_run_from_config[None-None-localhost:8080-localhost-8080] PASSED [ 70%]
tests/test_basic.py::test_run_from_config[None-None-localhost:0-localhost-0] PASSED [ 71%]
tests/test_basic.py::test_max_cookie_size FAILED                         [ 72%]
tests/test_basic.py::test_app_freed_on_zero_refcount PASSED              [ 72%]
tests/test_blueprints.py::test_blueprint_specific_error_handling FAILED  [ 73%]
tests/test_blueprints.py::test_blueprint_specific_user_error_handling FAILED [ 73%]
tests/test_blueprints.py::test_blueprint_app_error_handling FAILED       [ 74%]
tests/test_blueprints.py::test_blueprint_prefix_slash[-/-/] FAILED       [ 74%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/--/] FAILED       [ 75%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/-/-/] FAILED      [ 75%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo--/foo] FAILED [ 76%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/--/foo/] FAILED [ 77%]
tests/test_blueprints.py::test_blueprint_prefix_slash[-/bar-/bar] FAILED [ 77%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/-/bar-/foo/bar] FAILED [ 78%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/-bar-/foo/bar] FAILED [ 78%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo-/bar-/foo/bar] FAILED [ 79%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/-//bar-/foo/bar] FAILED [ 79%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo//-/bar-/foo/bar] FAILED [ 80%]
tests/test_blueprints.py::test_blueprint_url_defaults FAILED             [ 81%]
tests/test_blueprints.py::test_blueprint_url_processors FAILED           [ 81%]
tests/test_blueprints.py::test_templates_and_static ERROR                [ 82%]
tests/test_blueprints.py::test_default_static_max_age FAILED             [ 82%]
tests/test_blueprints.py::test_templates_list ERROR                      [ 83%]
tests/test_blueprints.py::test_dotted_names FAILED                       [ 83%]
tests/test_blueprints.py::test_dotted_names_from_app FAILED              [ 84%]
tests/test_blueprints.py::test_empty_url_defaults FAILED                 [ 84%]
tests/test_blueprints.py::test_route_decorator_custom_endpoint FAILED    [ 85%]
tests/test_blueprints.py::test_route_decorator_custom_endpoint_with_dots FAILED [ 86%]
tests/test_blueprints.py::test_endpoint_decorator FAILED                 [ 86%]
tests/test_blueprints.py::test_template_filter PASSED                    [ 87%]
tests/test_blueprints.py::test_add_template_filter PASSED                [ 87%]
tests/test_blueprints.py::test_template_filter_with_name PASSED          [ 88%]
tests/test_blueprints.py::test_add_template_filter_with_name PASSED      [ 88%]
tests/test_blueprints.py::test_template_filter_with_template FAILED      [ 89%]
tests/test_blueprints.py::test_template_filter_after_route_with_template FAILED [ 89%]
tests/test_blueprints.py::test_add_template_filter_with_template FAILED  [ 90%]
tests/test_blueprints.py::test_template_filter_with_name_and_template FAILED [ 91%]
tests/test_blueprints.py::test_add_template_filter_with_name_and_template FAILED [ 91%]
tests/test_blueprints.py::test_template_test PASSED                      [ 92%]
tests/test_blueprints.py::test_add_template_test PASSED                  [ 92%]
tests/test_blueprints.py::test_template_test_with_name PASSED            [ 93%]
tests/test_blueprints.py::test_add_template_test_with_name PASSED        [ 93%]
tests/test_blueprints.py::test_template_test_with_template FAILED        [ 94%]
tests/test_blueprints.py::test_template_test_after_route_with_template FAILED [ 94%]
tests/test_blueprints.py::test_add_template_test_with_template FAILED    [ 95%]
tests/test_blueprints.py::test_template_test_with_name_and_template FAILED [ 96%]
tests/test_blueprints.py::test_add_template_test_with_name_and_template FAILED [ 96%]
tests/test_blueprints.py::test_context_processing FAILED                 [ 97%]
tests/test_blueprints.py::test_template_global PASSED                    [ 97%]
tests/test_blueprints.py::test_request_processing FAILED                 [ 98%]
tests/test_blueprints.py::test_app_request_processing FAILED             [ 98%]
tests/test_blueprints.py::test_app_url_processors FAILED                 [ 99%]
tests/test_blueprints.py::test_nested_blueprint FAILED                   [100%]

=========================== short test summary info ============================
PASSED tests/test_basic.py::test_method_route_no_methods
PASSED tests/test_basic.py::test_disallow_string_for_allowed_methods
PASSED tests/test_basic.py::test_error_handler_unknown_code
PASSED tests/test_basic.py::test_request_locals
PASSED tests/test_basic.py::test_exception_propagation
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-True-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-True-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-False-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-False-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-True-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-True-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-False-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-False-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-True-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-True-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-False-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-False-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-True-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-True-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-False-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-False-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-True-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-True-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-False-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-False-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-True-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-True-False]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-False-True]
PASSED tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-False-False]
PASSED tests/test_basic.py::test_get_method_on_g
PASSED tests/test_basic.py::test_g_iteration_protocol
PASSED tests/test_basic.py::test_run_defaults
PASSED tests/test_basic.py::test_run_server_port
PASSED tests/test_basic.py::test_run_from_config[None-None-pocoo.org:8080-pocoo.org-8080]
PASSED tests/test_basic.py::test_run_from_config[localhost-None-pocoo.org:8080-localhost-8080]
PASSED tests/test_basic.py::test_run_from_config[None-80-pocoo.org:8080-pocoo.org-80]
PASSED tests/test_basic.py::test_run_from_config[localhost-80-pocoo.org:8080-localhost-80]
PASSED tests/test_basic.py::test_run_from_config[localhost-0-localhost:8080-localhost-0]
PASSED tests/test_basic.py::test_run_from_config[None-None-localhost:8080-localhost-8080]
PASSED tests/test_basic.py::test_run_from_config[None-None-localhost:0-localhost-0]
PASSED tests/test_basic.py::test_app_freed_on_zero_refcount
PASSED tests/test_blueprints.py::test_template_filter
PASSED tests/test_blueprints.py::test_add_template_filter
PASSED tests/test_blueprints.py::test_template_filter_with_name
PASSED tests/test_blueprints.py::test_add_template_filter_with_name
PASSED tests/test_blueprints.py::test_template_test
PASSED tests/test_blueprints.py::test_add_template_test
PASSED tests/test_blueprints.py::test_template_test_with_name
PASSED tests/test_blueprints.py::test_add_template_test_with_name
PASSED tests/test_blueprints.py::test_template_global
ERROR tests/test_basic.py::test_flashes - DeprecationWarning: 'werkzeug.urls....
ERROR tests/test_basic.py::test_make_response - DeprecationWarning: 'werkzeug...
ERROR tests/test_basic.py::test_make_response_with_response_instance - Deprec...
ERROR tests/test_basic.py::test_jsonify_no_prettyprint - DeprecationWarning: ...
ERROR tests/test_basic.py::test_jsonify_prettyprint - DeprecationWarning: 'we...
ERROR tests/test_basic.py::test_jsonify_mimetype - DeprecationWarning: 'werkz...
ERROR tests/test_basic.py::test_json_dump_dataclass - DeprecationWarning: 'we...
ERROR tests/test_basic.py::test_jsonify_args_and_kwargs_check - DeprecationWa...
ERROR tests/test_basic.py::test_url_generation - DeprecationWarning: 'werkzeu...
ERROR tests/test_blueprints.py::test_templates_and_static - DeprecationWarnin...
ERROR tests/test_blueprints.py::test_templates_list - DeprecationWarning: pkg...
FAILED tests/test_basic.py::test_options_work - DeprecationWarning: 'werkzeug...
FAILED tests/test_basic.py::test_options_on_multiple_rules - DeprecationWarni...
FAILED tests/test_basic.py::test_method_route[get] - DeprecationWarning: 'wer...
FAILED tests/test_basic.py::test_method_route[post] - DeprecationWarning: 'we...
FAILED tests/test_basic.py::test_method_route[put] - DeprecationWarning: 'wer...
FAILED tests/test_basic.py::test_method_route[delete] - DeprecationWarning: '...
FAILED tests/test_basic.py::test_method_route[patch] - DeprecationWarning: 'w...
FAILED tests/test_basic.py::test_provide_automatic_options_attr - Deprecation...
FAILED tests/test_basic.py::test_provide_automatic_options_kwarg - Deprecatio...
FAILED tests/test_basic.py::test_request_dispatching - DeprecationWarning: 'w...
FAILED tests/test_basic.py::test_url_mapping - DeprecationWarning: 'werkzeug....
FAILED tests/test_basic.py::test_werkzeug_routing - DeprecationWarning: 'werk...
FAILED tests/test_basic.py::test_endpoint_decorator - DeprecationWarning: 'we...
FAILED tests/test_basic.py::test_session - DeprecationWarning: 'werkzeug.urls...
FAILED tests/test_basic.py::test_session_using_server_name - TypeError: __ini...
FAILED tests/test_basic.py::test_session_using_server_name_and_port - TypeErr...
FAILED tests/test_basic.py::test_session_using_server_name_port_and_path - Ty...
FAILED tests/test_basic.py::test_session_using_application_root - TypeError: ...
FAILED tests/test_basic.py::test_session_using_session_settings - TypeError: ...
FAILED tests/test_basic.py::test_session_using_samesite_attribute - Deprecati...
FAILED tests/test_basic.py::test_session_localhost_warning - TypeError: __ini...
FAILED tests/test_basic.py::test_session_ip_warning - TypeError: __init__() g...
FAILED tests/test_basic.py::test_missing_session - DeprecationWarning: 'werkz...
FAILED tests/test_basic.py::test_session_expiration - DeprecationWarning: 'we...
FAILED tests/test_basic.py::test_session_stored_last - DeprecationWarning: 'w...
FAILED tests/test_basic.py::test_session_special_types - DeprecationWarning: ...
FAILED tests/test_basic.py::test_session_cookie_setting - DeprecationWarning:...
FAILED tests/test_basic.py::test_session_vary_cookie - DeprecationWarning: 'w...
FAILED tests/test_basic.py::test_extended_flashing - DeprecationWarning: 'wer...
FAILED tests/test_basic.py::test_request_processing - DeprecationWarning: 'we...
FAILED tests/test_basic.py::test_request_preprocessing_early_return - Depreca...
FAILED tests/test_basic.py::test_after_request_processing - DeprecationWarnin...
FAILED tests/test_basic.py::test_teardown_request_handler - DeprecationWarnin...
FAILED tests/test_basic.py::test_teardown_request_handler_debug_mode - Deprec...
FAILED tests/test_basic.py::test_teardown_request_handler_error - Deprecation...
FAILED tests/test_basic.py::test_before_after_request_order - DeprecationWarn...
FAILED tests/test_basic.py::test_error_handling - DeprecationWarning: 'werkze...
FAILED tests/test_basic.py::test_error_handling_processing - DeprecationWarni...
FAILED tests/test_basic.py::test_baseexception_error_handling - DeprecationWa...
FAILED tests/test_basic.py::test_before_request_and_routing_errors - Deprecat...
FAILED tests/test_basic.py::test_user_error_handling - DeprecationWarning: 'w...
FAILED tests/test_basic.py::test_http_error_subclass_handling - DeprecationWa...
FAILED tests/test_basic.py::test_errorhandler_precedence - DeprecationWarning...
FAILED tests/test_basic.py::test_trapping_of_bad_request_key_errors - Depreca...
FAILED tests/test_basic.py::test_trapping_of_all_http_exceptions - Deprecatio...
FAILED tests/test_basic.py::test_error_handler_after_processor_error - Deprec...
FAILED tests/test_basic.py::test_enctype_debug_helper - DeprecationWarning: '...
FAILED tests/test_basic.py::test_response_types - DeprecationWarning: 'werkze...
FAILED tests/test_basic.py::test_response_type_errors - DeprecationWarning: '...
FAILED tests/test_basic.py::test_build_error_handler - DeprecationWarning: 'w...
FAILED tests/test_basic.py::test_build_error_handler_reraise - DeprecationWar...
FAILED tests/test_basic.py::test_url_for_passes_special_values_to_build_error_handler
FAILED tests/test_basic.py::test_static_files - DeprecationWarning: 'werkzeug...
FAILED tests/test_basic.py::test_static_url_path - DeprecationWarning: 'werkz...
FAILED tests/test_basic.py::test_static_url_path_with_ending_slash - Deprecat...
FAILED tests/test_basic.py::test_static_url_empty_path - DeprecationWarning: ...
FAILED tests/test_basic.py::test_static_url_empty_path_default - DeprecationW...
FAILED tests/test_basic.py::test_static_folder_with_pathlib_path - Deprecatio...
FAILED tests/test_basic.py::test_static_folder_with_ending_slash - Deprecatio...
FAILED tests/test_basic.py::test_static_route_with_host_matching - Deprecatio...
FAILED tests/test_basic.py::test_server_name_subdomain - DeprecationWarning: ...
FAILED tests/test_basic.py::test_max_content_length - DeprecationWarning: 'we...
FAILED tests/test_basic.py::test_url_processors - DeprecationWarning: 'werkze...
FAILED tests/test_basic.py::test_inject_blueprint_url_defaults - ValueError: ...
FAILED tests/test_basic.py::test_nonascii_pathinfo - DeprecationWarning: 'wer...
FAILED tests/test_basic.py::test_debug_mode_complains_after_first_request - D...
FAILED tests/test_basic.py::test_before_first_request_functions - Deprecation...
FAILED tests/test_basic.py::test_before_first_request_functions_concurrent - ...
FAILED tests/test_basic.py::test_routing_redirect_debugging - DeprecationWarn...
FAILED tests/test_basic.py::test_route_decorator_custom_endpoint - Deprecatio...
FAILED tests/test_basic.py::test_preserve_only_once - DeprecationWarning: 'we...
FAILED tests/test_basic.py::test_preserve_remembers_exception - DeprecationWa...
FAILED tests/test_basic.py::test_subdomain_basic_support - TypeError: __init_...
FAILED tests/test_basic.py::test_subdomain_matching - TypeError: __init__() g...
FAILED tests/test_basic.py::test_subdomain_matching_with_ports - TypeError: _...
FAILED tests/test_basic.py::test_subdomain_matching_other_name[False] - TypeE...
FAILED tests/test_basic.py::test_subdomain_matching_other_name[True] - TypeEr...
FAILED tests/test_basic.py::test_multi_route_rules - DeprecationWarning: 'wer...
FAILED tests/test_basic.py::test_multi_route_class_views - DeprecationWarning...
FAILED tests/test_basic.py::test_max_cookie_size - TypeError: __init__() got ...
FAILED tests/test_blueprints.py::test_blueprint_specific_error_handling - Dep...
FAILED tests/test_blueprints.py::test_blueprint_specific_user_error_handling
FAILED tests/test_blueprints.py::test_blueprint_app_error_handling - Deprecat...
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[-/-/] - Deprecat...
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/--/] - Deprecat...
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/-/-/] - Depreca...
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/foo--/foo] - De...
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/--/foo/] - ...
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[-/bar-/bar] - De...
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/-/bar-/foo/bar]
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/-bar-/foo/bar]
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/foo-/bar-/foo/bar]
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/-//bar-/foo/bar]
FAILED tests/test_blueprints.py::test_blueprint_prefix_slash[/foo//-/bar-/foo/bar]
FAILED tests/test_blueprints.py::test_blueprint_url_defaults - DeprecationWar...
FAILED tests/test_blueprints.py::test_blueprint_url_processors - DeprecationW...
FAILED tests/test_blueprints.py::test_default_static_max_age - DeprecationWar...
FAILED tests/test_blueprints.py::test_dotted_names - ValueError: Blueprint na...
FAILED tests/test_blueprints.py::test_dotted_names_from_app - DeprecationWarn...
FAILED tests/test_blueprints.py::test_empty_url_defaults - DeprecationWarning...
FAILED tests/test_blueprints.py::test_route_decorator_custom_endpoint - Depre...
FAILED tests/test_blueprints.py::test_route_decorator_custom_endpoint_with_dots
FAILED tests/test_blueprints.py::test_endpoint_decorator - DeprecationWarning...
FAILED tests/test_blueprints.py::test_template_filter_with_template - Depreca...
FAILED tests/test_blueprints.py::test_template_filter_after_route_with_template
FAILED tests/test_blueprints.py::test_add_template_filter_with_template - Dep...
FAILED tests/test_blueprints.py::test_template_filter_with_name_and_template
FAILED tests/test_blueprints.py::test_add_template_filter_with_name_and_template
FAILED tests/test_blueprints.py::test_template_test_with_template - Deprecati...
FAILED tests/test_blueprints.py::test_template_test_after_route_with_template
FAILED tests/test_blueprints.py::test_add_template_test_with_template - Depre...
FAILED tests/test_blueprints.py::test_template_test_with_name_and_template - ...
FAILED tests/test_blueprints.py::test_add_template_test_with_name_and_template
FAILED tests/test_blueprints.py::test_context_processing - DeprecationWarning...
FAILED tests/test_blueprints.py::test_request_processing - DeprecationWarning...
FAILED tests/test_blueprints.py::test_app_request_processing - DeprecationWar...
FAILED tests/test_blueprints.py::test_app_url_processors - DeprecationWarning...
FAILED tests/test_blueprints.py::test_nested_blueprint - DeprecationWarning: ...
================== 118 failed, 50 passed, 11 errors in 0.68s ===================

</test-errors>

<file>
<path>src/flask/blueprints.py</path>
<content>
1: import typing as t
2: from collections import defaultdict
3: from functools import update_wrapper
4: 
5: from .scaffold import _endpoint_from_view_func
6: from .scaffold import _sentinel
7: from .scaffold import Scaffold
8: from .typing import AfterRequestCallable
9: from .typing import BeforeRequestCallable
10: from .typing import ErrorHandlerCallable
11: from .typing import TeardownCallable
12: from .typing import TemplateContextProcessorCallable
13: from .typing import TemplateFilterCallable
14: from .typing import TemplateGlobalCallable
15: from .typing import TemplateTestCallable
16: from .typing import URLDefaultCallable
17: from .typing import URLValuePreprocessorCallable
18: 
19: if t.TYPE_CHECKING:
20:     from .app import Flask
21: 
22: DeferredSetupFunction = t.Callable[["BlueprintSetupState"], t.Callable]
23: 
24: 
25: class BlueprintSetupState:
26:     """Temporary holder object for registering a blueprint with the
27:     application.  An instance of this class is created by the
28:     :meth:`~flask.Blueprint.make_setup_state` method and later passed
29:     to all register callback functions.
30:     """
31: 
32:     def __init__(
33:         self,
34:         blueprint: "Blueprint",
35:         app: "Flask",
36:         options: t.Any,
37:         first_registration: bool,
38:     ) -> None:
39:         #: a reference to the current application
40:         self.app = app
41: 
42:         #: a reference to the blueprint that created this setup state.
43:         self.blueprint = blueprint
44: 
45:         #: a dictionary with all options that were passed to the
46:         #: :meth:`~flask.Flask.register_blueprint` method.
47:         self.options = options
48: 
49:         #: as blueprints can be registered multiple times with the
50:         #: application and not everything wants to be registered
51:         #: multiple times on it, this attribute can be used to figure
52:         #: out if the blueprint was registered in the past already.
53:         self.first_registration = first_registration
54: 
55:         subdomain = self.options.get("subdomain")
56:         if subdomain is None:
57:             subdomain = self.blueprint.subdomain
58: 
59:         #: The subdomain that the blueprint should be active for, ``None``
60:         #: otherwise.
61:         self.subdomain = subdomain
62: 
63:         url_prefix = self.options.get("url_prefix")
64:         if url_prefix is None:
65:             url_prefix = self.blueprint.url_prefix
66:         #: The prefix that should be used for all URLs defined on the
67:         #: blueprint.
68:         self.url_prefix = url_prefix
69: 
70:         self.name_prefix = self.options.get("name_prefix", "")
71: 
72:         #: A dictionary with URL defaults that is added to each and every
73:         #: URL that was defined with the blueprint.
74:         self.url_defaults = dict(self.blueprint.url_values_defaults)
75:         self.url_defaults.update(self.options.get("url_defaults", ()))
76: 
77:     def add_url_rule(
78:         self,
79:         rule: str,
80:         endpoint: t.Optional[str] = None,
81:         view_func: t.Optional[t.Callable] = None,
82:         **options: t.Any,
83:     ) -> None:
84:         """A helper method to register a rule (and optionally a view function)
85:         to the application.  The endpoint is automatically prefixed with the
86:         blueprint's name.
87:         """
88:         if self.url_prefix is not None:
89:             if rule:
90:                 rule = "/".join((self.url_prefix.rstrip("/"), rule.lstrip("/")))
91:             else:
92:                 rule = self.url_prefix
93:         options.setdefault("subdomain", self.subdomain)
94:         if endpoint is None:
95:             endpoint = _endpoint_from_view_func(view_func)  # type: ignore
96:         defaults = self.url_defaults
97:         if "defaults" in options:
98:             defaults = dict(defaults, **options.pop("defaults"))
99:         self.app.add_url_rule(
100:             rule,
101:             f"{self.name_prefix}{self.blueprint.name}.{endpoint}",
102:             view_func,
103:             defaults=defaults,
104:             **options,
105:         )
106: 
107: 
108: class Blueprint(Scaffold):
109:     """Represents a blueprint, a collection of routes and other
110:     app-related functions that can be registered on a real application
111:     later.
112: 
113:     A blueprint is an object that allows defining application functions
114:     without requiring an application object ahead of time. It uses the
115:     same decorators as :class:`~flask.Flask`, but defers the need for an
116:     application by recording them for later registration.
117: 
118:     Decorating a function with a blueprint creates a deferred function
119:     that is called with :class:`~flask.blueprints.BlueprintSetupState`
120:     when the blueprint is registered on an application.
121: 
122:     See :doc:`/blueprints` for more information.
123: 
124:     :param name: The name of the blueprint. Will be prepended to each
125:         endpoint name.
126:     :param import_name: The name of the blueprint package, usually
127:         ``__name__``. This helps locate the ``root_path`` for the
128:         blueprint.
129:     :param static_folder: A folder with static files that should be
130:         served by the blueprint's static route. The path is relative to
131:         the blueprint's root path. Blueprint static files are disabled
132:         by default.
133:     :param static_url_path: The url to serve static files from.
134:         Defaults to ``static_folder``. If the blueprint does not have
135:         a ``url_prefix``, the app's static route will take precedence,
136:         and the blueprint's static files won't be accessible.
137:     :param template_folder: A folder with templates that should be added
138:         to the app's template search path. The path is relative to the
139:         blueprint's root path. Blueprint templates are disabled by
140:         default. Blueprint templates have a lower precedence than those
141:         in the app's templates folder.
142:     :param url_prefix: A path to prepend to all of the blueprint's URLs,
143:         to make them distinct from the rest of the app's routes.
144:     :param subdomain: A subdomain that blueprint routes will match on by
145:         default.
146:     :param url_defaults: A dict of default values that blueprint routes
147:         will receive by default.
148:     :param root_path: By default, the blueprint will automatically set
149:         this based on ``import_name``. In certain situations this
150:         automatic detection can fail, so the path can be specified
151:         manually instead.
152: 
153:     .. versionchanged:: 1.1.0
154:         Blueprints have a ``cli`` group to register nested CLI commands.
155:         The ``cli_group`` parameter controls the name of the group under
156:         the ``flask`` command.
157: 
158:     .. versionadded:: 0.7
159:     """
160: 
161:     warn_on_modifications = False
162:     _got_registered_once = False
163: 
164:     #: Blueprint local JSON encoder class to use. Set to ``None`` to use
165:     #: the app's :class:`~flask.Flask.json_encoder`.
166:     json_encoder = None
167:     #: Blueprint local JSON decoder class to use. Set to ``None`` to use
168:     #: the app's :class:`~flask.Flask.json_decoder`.
169:     json_decoder = None
170: 
171:     def __init__(
172:             self,
173:             name: str,
174:             import_name: str,
175:             static_folder: t.Optional[str] = None,
176:             static_url_path: t.Optional[str] = None,
177:             template_folder: t.Optional[str] = None,
178:             url_prefix: t.Optional[str] = None,
179:             subdomain: t.Optional[str] = None,
180:             url_defaults: t.Optional[dict] = None,
181:             root_path: t.Optional[str] = None,
182:             cli_group: t.Optional[str] = _sentinel,  # type: ignore
183:     ):
184:         if '.' in name:
185:             raise ValueError("Blueprint name should not contain dots.")
186:         super().__init__(
187:             import_name=import_name,
188:             static_folder=static_folder,
189:             static_url_path=static_url_path,
190:             template_folder=template_folder,
191:             root_path=root_path,
192:         )
193:         self.name = name
194:         self.url_prefix = url_prefix
195:         self.subdomain = subdomain
196:         self.deferred_functions: t.List[DeferredSetupFunction] = []
197: 
198:         if url_defaults is None:
199:             url_defaults = {}
200: 
201:         self.url_values_defaults = url_defaults
202:         self.cli_group = cli_group
203:         self._blueprints: t.List[t.Tuple["Blueprint", dict]] = []
204: 
205:     def _is_setup_finished(self) -> bool:
206:         return self.warn_on_modifications and self._got_registered_once
207: 
208:     def record(self, func: t.Callable) -> None:
209:         """Registers a function that is called when the blueprint is
210:         registered on the application.  This function is called with the
211:         state as argument as returned by the :meth:`make_setup_state`
212:         method.
213:         """
214:         if self._got_registered_once and self.warn_on_modifications:
215:             from warnings import warn
216: 
217:             warn(
218:                 Warning(
219:                     "The blueprint was already registered once but is"
220:                     " getting modified now. These changes will not show"
221:                     " up."
222:                 )
223:             )
224:         self.deferred_functions.append(func)
225: 
226:     def record_once(self, func: t.Callable) -> None:
227:         """Works like :meth:`record` but wraps the function in another
228:         function that will ensure the function is only called once.  If the
229:         blueprint is registered a second time on the application, the
230:         function passed is not called.
231:         """
232: 
233:         def wrapper(state: BlueprintSetupState) -> None:
234:             if state.first_registration:
235:                 func(state)
236: 
237:         return self.record(update_wrapper(wrapper, func))
238: 
239:     def make_setup_state(
240:         self, app: "Flask", options: dict, first_registration: bool = False
241:     ) -> BlueprintSetupState:
242:         """Creates an instance of :meth:`~flask.blueprints.BlueprintSetupState`
243:         object that is later passed to the register callback functions.
244:         Subclasses can override this to return a subclass of the setup state.
245:         """
246:         return BlueprintSetupState(self, app, options, first_registration)
247: 
248:     def register_blueprint(self, blueprint: "Blueprint", **options: t.Any) -> None:
249:         """Register a :class:`~flask.Blueprint` on this blueprint. Keyword
250:         arguments passed to this method will override the defaults set
251:         on the blueprint.
252: 
253:         .. versionadded:: 2.0
254:         """
255:         self._blueprints.append((blueprint, options))
256: 
257:     def register(self, app: "Flask", options: dict) -> None:
258:         """Called by :meth:`Flask.register_blueprint` to register all
259:         views and callbacks registered on the blueprint with the
260:         application. Creates a :class:`.BlueprintSetupState` and calls
261:         each :meth:`record` callbackwith it.
262: 
263:         :param app: The application this blueprint is being registered
264:             with.
265:         :param options: Keyword arguments forwarded from
266:             :meth:`~Flask.register_blueprint`.
267:         :param first_registration: Whether this is the first time this
268:             blueprint has been registered on the application.
269:         """
270:         first_registration = False
271: 
272:         if self.name in app.blueprints:
273:             assert app.blueprints[self.name] is self, (
274:                 "A name collision occurred between blueprints"
275:                 f" {self!r} and {app.blueprints[self.name]!r}."
276:                 f" Both share the same name {self.name!r}."
277:                 f" Blueprints that are created on the fly need unique"
278:                 f" names."
279:             )
280:         else:
281:             app.blueprints[self.name] = self
282:             first_registration = True
283: 
284:         self._got_registered_once = True
285:         state = self.make_setup_state(app, options, first_registration)
286: 
287:         if self.has_static_folder:
288:             state.add_url_rule(
289:                 f"{self.static_url_path}/<path:filename>",
290:                 view_func=self.send_static_file,
291:                 endpoint="static",
292:             )
293: 
294:         # Merge blueprint data into parent.
295:         if first_registration:
296: 
297:             def extend(bp_dict, parent_dict):
298:                 for key, values in bp_dict.items():
299:                     key = self.name if key is None else f"{self.name}.{key}"
300: 
301:                     parent_dict[key].extend(values)
302: 
303:             for key, value in self.error_handler_spec.items():
304:                 key = self.name if key is None else f"{self.name}.{key}"
305:                 value = defaultdict(
306:                     dict,
307:                     {
308:                         code: {
309:                             exc_class: func for exc_class, func in code_values.items()
310:                         }
311:                         for code, code_values in value.items()
312:                     },
313:                 )
314:                 app.error_handler_spec[key] = value
315: 
316:             for endpoint, func in self.view_functions.items():
317:                 app.view_functions[endpoint] = func
318: 
319:             extend(self.before_request_funcs, app.before_request_funcs)
320:             extend(self.after_request_funcs, app.after_request_funcs)
321:             extend(
322:                 self.teardown_request_funcs,
323:                 app.teardown_request_funcs,
324:             )
325:             extend(self.url_default_functions, app.url_default_functions)
326:             extend(self.url_value_preprocessors, app.url_value_preprocessors)
327:             extend(self.template_context_processors, app.template_context_processors)
328: 
329:         for deferred in self.deferred_functions:
330:             deferred(state)
331: 
332:         cli_resolved_group = options.get("cli_group", self.cli_group)
333: 
334:         if self.cli.commands:
335:             if cli_resolved_group is None:
336:                 app.cli.commands.update(self.cli.commands)
337:             elif cli_resolved_group is _sentinel:
338:                 self.cli.name = self.name
339:                 app.cli.add_command(self.cli)
340:             else:
341:                 self.cli.name = cli_resolved_group
342:                 app.cli.add_command(self.cli)
343: 
344:         for blueprint, bp_options in self._blueprints:
345:             url_prefix = options.get("url_prefix", "")
346:             if "url_prefix" in bp_options:
347:                 url_prefix = (
348:                     url_prefix.rstrip("/") + "/" + bp_options["url_prefix"].lstrip("/")
349:                 )
350: 
351:             bp_options["url_prefix"] = url_prefix
352:             bp_options["name_prefix"] = options.get("name_prefix", "") + self.name + "."
353:             blueprint.register(app, bp_options)
354: 
355:     def add_url_rule(
356:         self,
357:         rule: str,
358:         endpoint: t.Optional[str] = None,
359:         view_func: t.Optional[t.Callable] = None,
360:         **options: t.Any,
361:     ) -> None:
362:         """Like :meth:`Flask.add_url_rule` but for a blueprint.  The endpoint for
363:         the :func:`url_for` function is prefixed with the name of the blueprint.
364:         """
365:         if endpoint:
366:             assert "." not in endpoint, "Blueprint endpoints should not contain dots"
367:         if view_func and hasattr(view_func, "__name__"):
368:             assert (
369:                 "." not in view_func.__name__
370:             ), "Blueprint view function name should not contain dots"
371:         self.record(lambda s: s.add_url_rule(rule, endpoint, view_func, **options))
372: 
373:     def app_template_filter(self, name: t.Optional[str] = None) -> t.Callable:
374:         """Register a custom template filter, available application wide.  Like
375:         :meth:`Flask.template_filter` but for a blueprint.
376: 
377:         :param name: the optional name of the filter, otherwise the
378:                      function name will be used.
379:         """
380: 
381:         def decorator(f: TemplateFilterCallable) -> TemplateFilterCallable:
382:             self.add_app_template_filter(f, name=name)
383:             return f
384: 
385:         return decorator
386: 
387:     def add_app_template_filter(
388:         self, f: TemplateFilterCallable, name: t.Optional[str] = None
389:     ) -> None:
390:         """Register a custom template filter, available application wide.  Like
391:         :meth:`Flask.add_template_filter` but for a blueprint.  Works exactly
392:         like the :meth:`app_template_filter` decorator.
393: 
394:         :param name: the optional name of the filter, otherwise the
395:                      function name will be used.
396:         """
397: 
398:         def register_template(state: BlueprintSetupState) -> None:
399:             state.app.jinja_env.filters[name or f.__name__] = f
400: 
401:         self.record_once(register_template)
402: 
403:     def app_template_test(self, name: t.Optional[str] = None) -> t.Callable:
404:         """Register a custom template test, available application wide.  Like
405:         :meth:`Flask.template_test` but for a blueprint.
406: 
407:         .. versionadded:: 0.10
408: 
409:         :param name: the optional name of the test, otherwise the
410:                      function name will be used.
411:         """
412: 
413:         def decorator(f: TemplateTestCallable) -> TemplateTestCallable:
414:             self.add_app_template_test(f, name=name)
415:             return f
416: 
417:         return decorator
418: 
419:     def add_app_template_test(
420:         self, f: TemplateTestCallable, name: t.Optional[str] = None
421:     ) -> None:
422:         """Register a custom template test, available application wide.  Like
423:         :meth:`Flask.add_template_test` but for a blueprint.  Works exactly
424:         like the :meth:`app_template_test` decorator.
425: 
426:         .. versionadded:: 0.10
427: 
428:         :param name: the optional name of the test, otherwise the
429:                      function name will be used.
430:         """
431: 
432:         def register_template(state: BlueprintSetupState) -> None:
433:             state.app.jinja_env.tests[name or f.__name__] = f
434: 
435:         self.record_once(register_template)
436: 
437:     def app_template_global(self, name: t.Optional[str] = None) -> t.Callable:
438:         """Register a custom template global, available application wide.  Like
439:         :meth:`Flask.template_global` but for a blueprint.
440: 
441:         .. versionadded:: 0.10
442: 
443:         :param name: the optional name of the global, otherwise the
444:                      function name will be used.
445:         """
446: 
447:         def decorator(f: TemplateGlobalCallable) -> TemplateGlobalCallable:
448:             self.add_app_template_global(f, name=name)
449:             return f
450: 
451:         return decorator
452: 
453:     def add_app_template_global(
454:         self, f: TemplateGlobalCallable, name: t.Optional[str] = None
455:     ) -> None:
456:         """Register a custom template global, available application wide.  Like
457:         :meth:`Flask.add_template_global` but for a blueprint.  Works exactly
458:         like the :meth:`app_template_global` decorator.
459: 
460:         .. versionadded:: 0.10
461: 
462:         :param name: the optional name of the global, otherwise the
463:                      function name will be used.
464:         """
465: 
466:         def register_template(state: BlueprintSetupState) -> None:
467:             state.app.jinja_env.globals[name or f.__name__] = f
468: 
469:         self.record_once(register_template)
470: 
471:     def before_app_request(self, f: BeforeRequestCallable) -> BeforeRequestCallable:
472:         """Like :meth:`Flask.before_request`.  Such a function is executed
473:         before each request, even if outside of a blueprint.
474:         """
475:         self.record_once(
476:             lambda s: s.app.before_request_funcs.setdefault(None, []).append(f)
477:         )
478:         return f
479: 
480:     def before_app_first_request(
481:         self, f: BeforeRequestCallable
482:     ) -> BeforeRequestCallable:
483:         """Like :meth:`Flask.before_first_request`.  Such a function is
484:         executed before the first request to the application.
485:         """
486:         self.record_once(lambda s: s.app.before_first_request_funcs.append(f))
487:         return f
488: 
489:     def after_app_request(self, f: AfterRequestCallable) -> AfterRequestCallable:
490:         """Like :meth:`Flask.after_request` but for a blueprint.  Such a function
491:         is executed after each request, even if outside of the blueprint.
492:         """
493:         self.record_once(
494:             lambda s: s.app.after_request_funcs.setdefault(None, []).append(f)
495:         )
496:         return f
497: 
498:     def teardown_app_request(self, f: TeardownCallable) -> TeardownCallable:
499:         """Like :meth:`Flask.teardown_request` but for a blueprint.  Such a
500:         function is executed when tearing down each request, even if outside of
501:         the blueprint.
502:         """
503:         self.record_once(
504:             lambda s: s.app.teardown_request_funcs.setdefault(None, []).append(f)
505:         )
506:         return f
507: 
508:     def app_context_processor(
509:         self, f: TemplateContextProcessorCallable
510:     ) -> TemplateContextProcessorCallable:
511:         """Like :meth:`Flask.context_processor` but for a blueprint.  Such a
512:         function is executed each request, even if outside of the blueprint.
513:         """
514:         self.record_once(
515:             lambda s: s.app.template_context_processors.setdefault(None, []).append(f)
516:         )
517:         return f
518: 
519:     def app_errorhandler(self, code: t.Union[t.Type[Exception], int]) -> t.Callable:
520:         """Like :meth:`Flask.errorhandler` but for a blueprint.  This
521:         handler is used for all requests, even if outside of the blueprint.
522:         """
523: 
524:         def decorator(f: ErrorHandlerCallable) -> ErrorHandlerCallable:
525:             self.record_once(lambda s: s.app.errorhandler(code)(f))
526:             return f
527: 
528:         return decorator
529: 
530:     def app_url_value_preprocessor(
531:         self, f: URLValuePreprocessorCallable
532:     ) -> URLValuePreprocessorCallable:
533:         """Same as :meth:`url_value_preprocessor` but application wide."""
534:         self.record_once(
535:             lambda s: s.app.url_value_preprocessors.setdefault(None, []).append(f)
536:         )
537:         return f
538: 
539:     def app_url_defaults(self, f: URLDefaultCallable) -> URLDefaultCallable:
540:         """Same as :meth:`url_defaults` but application wide."""
541:         self.record_once(
542:             lambda s: s.app.url_default_functions.setdefault(None, []).append(f)
543:         )
544:         return f
545: 
</content>
</file>
